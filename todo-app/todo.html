<!doctype html>
<html lang="en">
<!-- 
 /**
 * Copyright (c) 2005-2018 Henrik Javen, H-Consulting. All rights reserved 
 * Doo-ui.org
 * todo.html 
 */
--> 
<head>
<meta charset="utf-8">
<title>Doo-ui.org</title>
<style type="text/css">
	SPAN, A {margin-right:4px;}
	.selected {text-decoration:none;}
	.completed_false {text-decoration: none;}
	.completed_true {text-decoration: line-through;}
	#allTodos {position:absolute; top:5px; right:5px;}
</style>
<script	src="../js/doo-ui.beta.5.min.js"></script>
</head>

<body>
	<div>
		<div>Show:</div>

		<!-- Doodad:todoVisibilityFilters -->
		<span id="todoVisibilityFilters">
			<a href="#" onclick="Doo('todoVisibilityFilters').action(event, '{action}')" class="{selected}">{text}</a>
		</span>

		<!-- Doodad:todoEntry -->
		<div id="todoEntry">
			<input value="{value}" />
			<button onclick="Doo('todoEntry').action(this.previousSibling)">{btn}</button>
		</div>

		<!-- Doodad:todoList -->
		<ul id="todoList">
			<li class="completed_{completed}" onclick="Doo('todoList').action({id})">{todo}</li>
		</ul>

		<!-- Doodad:allTodos -->
		<ol id="allTodos">
			<li class="completed_{completed}">{todo}</li>
		</ol>
	</div>

	<script type="text/javascript">
	
   		function init() {
    			
   			// Data sets
   			var todoEntryData = {"btn":"Add Todo", "value":""};
   			var todoListData = [];
   			var todoFilterTypes = [
   	     		{text:"All",   	action:"SHOW_ALL", selected:"selected"}, 
   				{text:"Active",	action:"SHOW_ACTIVE", selected:""},
   				{text:"Completed",	action:"SHOW_COMPLETED", selected:""}
   			  ]; 
   			
	   		// Initiate Data store
   			Doo.DataStore.create('todoList',todoListData);
	   		Doo.DataStore.create('todoVisibilityFilters',todoFilterTypes);
	   		Doo.DataStore.create('todoEntry',todoEntryData);
			
	   		// Connect data to templates instances 
			Doo('todoVisibilityFilters').connect('todoVisibilityFilters');
	      	Doo('todoList').connect('todoList');
	     	Doo('allTodos').connect('todoList');
	    	    Doo('todoEntry').connect('todoEntry');
	 		
	      	Doo('allTodos').setNonefound("");

	      	Doo.renderUI();
			
	      	// Enter todo - action
		    Doo('todoEntry').action = (todoInputElem) => {
		    		let todo = todoInputElem.value.trim();
		    		if (todo.length > 0) {
					let id = Doo('todoList')._id++;
		        	    	Doo.DataStore.append('todoList',    
				    					[{id, 
				    					todo,
				    					completed:false}]);
	
		        	    	todoInputElem.value = "";
				}
			}
			
	      	// Visibility filter - actions
			Doo('todoVisibilityFilters').action = (e, action) => {
		    		e.preventDefault();
  			    let criteria = (item) => {
  			        item.selected = '';
  			    	  	if (item.action === action) {
						item.selected = "selected";
  			    	  	}
  			    	 }
  			     Doo.DataStore.update('todoVisibilityFilters', criteria);

  			     let filter = (item) =>item;
  			     switch(action) {
 	    				case 'SHOW_ALL':
	     				break;
		        	    	case 'SHOW_ACTIVE':
		        	    		filter = (item) => {if (!item.completed) return item};
		  				break;
		        	    	case 'SHOW_COMPLETED':
		        	    		filter =(item) => {if (item.completed) return item}; 
		        	    		break;
		     	}
	     		Doo.DataStore.setFilter('todoList', filter);
	    	    }
			
	      	// todo list toggle action
			Doo('todoList').action = (id) => {
		    		let criteria = (item) => {
					    			        if (item.id === id) {
											item.completed = !item.completed;
						    			    }  
					    			     }
    			    Doo.DataStore.update('todoList', criteria);  		
			}
   		}   
    		Doo.ready(init);
	</script>
</body>
</html>